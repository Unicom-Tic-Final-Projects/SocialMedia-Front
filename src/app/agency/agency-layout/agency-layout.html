<div class="min-h-screen bg-[#FFFFFF] text-[#1A1A1A] md:grid" 
     [ngClass]="{
       'md:grid-cols-[72px,1fr]': isAgencySidebarCollapsed() && !showClientSidebar(),
       'md:grid-cols-[72px,260px,1fr]': isAgencySidebarCollapsed() && showClientSidebar(),
       'md:grid-cols-[260px,1fr]': !isAgencySidebarCollapsed() && !showClientSidebar(),
       'md:grid-cols-[260px,260px,1fr]': !isAgencySidebarCollapsed() && showClientSidebar()
     }">
  <!-- Main Agency Sidebar -->
  <aside
    class="fixed inset-y-0 left-0 z-30 flex flex-col gap-10 bg-[#F5F7FF] border-r border-[#D9E1FF] text-[#1A1A1A] shadow-xl transition-all duration-300 md:static md:translate-x-0 md:shadow-none group"
    [class.w-72]="!isAgencySidebarCollapsed()"
    [class.w-[72px]]="isAgencySidebarCollapsed()"
    [class.px-6]="!isAgencySidebarCollapsed()"
    [class.px-3]="isAgencySidebarCollapsed()"
    [class.py-8]="!isAgencySidebarCollapsed()"
    [class.py-6]="isAgencySidebarCollapsed()"
    [class.-translate-x-full]="!showMenu()"
    [class.translate-x-0]="showMenu()"
    (mouseenter)="isAgencySidebarCollapsed() && isAgencySidebarCollapsed.set(false)"
    (mouseleave)="selectedClient() && isAgencySidebarCollapsed.set(true)"
  >
    <!-- Logo/Header -->
    <div class="flex flex-col gap-1.5">
      @if (!isAgencySidebarCollapsed()) {
        <div class="text-2xl font-bold tracking-wide text-[#4C6FFF]">One<span class="text-[#1A1A1A]">vo</span></div>
        <div>
          <div class="text-lg font-semibold text-[#1A1A1A]">{{ getTenantName() }}</div>
          <div class="text-sm text-gray-600">Agency Workspace</div>
        </div>
      } @else {
        <div class="flex items-center justify-center">
          <div class="text-xl font-bold text-[#4C6FFF]">O</div>
        </div>
      }
    </div>

    <nav class="flex flex-col gap-1.5 text-sm font-medium">
      <a
        routerLink="/agency"
        routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
        [routerLinkActiveOptions]="{ exact: true }"
        class="flex items-center rounded-xl text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        [class.gap-3]="!isAgencySidebarCollapsed()"
        [class.gap-0]="isAgencySidebarCollapsed()"
        [class.px-4]="!isAgencySidebarCollapsed()"
        [class.px-0]="isAgencySidebarCollapsed()"
        [class.justify-center]="isAgencySidebarCollapsed()"
        [class.justify-start]="!isAgencySidebarCollapsed()"
        [class.py-3]="!isAgencySidebarCollapsed()"
        [class.py-2.5]="isAgencySidebarCollapsed()"
        (click)="showMenu.set(false)"
        [title]="isAgencySidebarCollapsed() ? 'Overview' : ''"
      >
        <i class="fa-solid fa-gauge w-5 text-center text-[#4C6FFF]"></i>
        @if (!isAgencySidebarCollapsed()) {
          <span>Overview</span>
        }
      </a>
      <a
        routerLink="/agency/clients"
        routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
        class="flex items-center rounded-xl text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        [class.gap-3]="!isAgencySidebarCollapsed()"
        [class.gap-0]="isAgencySidebarCollapsed()"
        [class.px-4]="!isAgencySidebarCollapsed()"
        [class.px-0]="isAgencySidebarCollapsed()"
        [class.justify-center]="isAgencySidebarCollapsed()"
        [class.justify-start]="!isAgencySidebarCollapsed()"
        [class.py-3]="!isAgencySidebarCollapsed()"
        [class.py-2.5]="isAgencySidebarCollapsed()"
        (click)="showMenu.set(false)"
        [title]="isAgencySidebarCollapsed() ? 'Clients' : ''"
      >
        <i class="fa-solid fa-users w-5 text-center text-[#4C6FFF]"></i>
        @if (!isAgencySidebarCollapsed()) {
          <span>Clients</span>
        }
      </a>
      <a
        routerLink="/agency/team-members"
        routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
        class="flex items-center rounded-xl text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        [class.gap-3]="!isAgencySidebarCollapsed()"
        [class.gap-0]="isAgencySidebarCollapsed()"
        [class.px-4]="!isAgencySidebarCollapsed()"
        [class.px-0]="isAgencySidebarCollapsed()"
        [class.justify-center]="isAgencySidebarCollapsed()"
        [class.justify-start]="!isAgencySidebarCollapsed()"
        [class.py-3]="!isAgencySidebarCollapsed()"
        [class.py-2.5]="isAgencySidebarCollapsed()"
        (click)="showMenu.set(false)"
        [title]="isAgencySidebarCollapsed() ? 'Team Members' : ''"
      >
        <i class="fa-solid fa-user-group w-5 text-center text-[#4C6FFF]"></i>
        @if (!isAgencySidebarCollapsed()) {
          <span>Team Members</span>
        }
      </a>
      <a
        routerLink="/agency/tasks"
        routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
        class="flex items-center rounded-xl text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        [class.gap-3]="!isAgencySidebarCollapsed()"
        [class.gap-0]="isAgencySidebarCollapsed()"
        [class.px-4]="!isAgencySidebarCollapsed()"
        [class.px-0]="isAgencySidebarCollapsed()"
        [class.justify-center]="isAgencySidebarCollapsed()"
        [class.justify-start]="!isAgencySidebarCollapsed()"
        [class.py-3]="!isAgencySidebarCollapsed()"
        [class.py-2.5]="isAgencySidebarCollapsed()"
        (click)="showMenu.set(false)"
        [title]="isAgencySidebarCollapsed() ? 'Tasks' : ''"
      >
        <i class="fa-solid fa-list-check w-5 text-center text-[#4C6FFF]"></i>
        @if (!isAgencySidebarCollapsed()) {
          <span>Tasks</span>
        }
      </a>
    </nav>

    <!-- Client Accounts Section -->
    @if (clientsWithAccounts().length > 0 && !isAgencySidebarCollapsed()) {
      <div class="mt-4 pt-4 border-t border-[#D9E1FF]">
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-2">
          Client Accounts
        </div>
        <div class="flex flex-col gap-1">
          @for (client of clientsWithAccounts(); track client.id) {
            <button
              (click)="selectClient(client); showMenu.set(false)"
              [class.bg-[#4C6FFF]]="selectedClient()?.id === client.id"
              [class.text-white]="selectedClient()?.id === client.id"
              [class.text-[#222222]]="selectedClient()?.id !== client.id"
              class="flex flex-col gap-1 rounded-xl px-4 py-2.5 text-left transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
            >
              <div class="text-sm font-medium">{{ client.name }}</div>
              @if (clientContextService.getUserAccount(client.id)) {
                <div class="text-xs opacity-75 truncate">{{ clientContextService.getUserAccount(client.id)?.email }}</div>
              }
            </button>
          }
        </div>
      </div>
    }
    @if (clientsWithAccounts().length > 0 && isAgencySidebarCollapsed()) {
      <div class="mt-4 pt-4 border-t border-[#D9E1FF]">
        <div class="flex flex-col gap-1">
          @for (client of clientsWithAccounts(); track client.id) {
            <button
              (click)="selectClient(client); showMenu.set(false)"
              [class.bg-[#4C6FFF]]="selectedClient()?.id === client.id"
              [class.text-white]="selectedClient()?.id === client.id"
              [class.text-[#222222]]="selectedClient()?.id !== client.id"
              class="flex items-center justify-center rounded-xl py-2.5 transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
              [title]="client.name"
            >
              <i class="fa-solid fa-user w-5 text-center text-[#4C6FFF]"></i>
            </button>
          }
        </div>
      </div>
    }

    <button
      class="mt-auto inline-flex items-center rounded-xl border border-red-200 bg-red-50 text-sm font-medium text-red-600 transition hover:border-red-300 hover:bg-red-100"
      [class.gap-3]="!isAgencySidebarCollapsed()"
      [class.gap-0]="isAgencySidebarCollapsed()"
      [class.px-4]="!isAgencySidebarCollapsed()"
      [class.px-0]="isAgencySidebarCollapsed()"
      [class.justify-center]="isAgencySidebarCollapsed()"
      [class.justify-start]="!isAgencySidebarCollapsed()"
      [class.py-3]="!isAgencySidebarCollapsed()"
      [class.py-2.5]="isAgencySidebarCollapsed()"
      (click)="logout()"
      [title]="isAgencySidebarCollapsed() ? 'Logout' : ''"
    >
      <i class="fa-solid fa-right-from-bracket w-5 text-center"></i>
      @if (!isAgencySidebarCollapsed()) {
        <span>Logout</span>
      }
    </button>
  </aside>

  <!-- Client Dashboard Sub-Sidebar -->
  @if (showClientSidebar() && selectedClient()) {
    <aside
      class="fixed inset-y-0 z-20 flex w-72 -translate-x-full flex-col gap-6 bg-[#F0F4FF] border-r border-[#D9E1FF] px-6 py-8 text-[#1A1A1A] shadow-xl transition-all duration-300 md:static md:translate-x-0 md:shadow-none"
      [class.left-72]="!isAgencySidebarCollapsed()"
      [class.left-[72px]]="isAgencySidebarCollapsed()"
      [class.translate-x-0]="showMenu()"
    >
      <!-- Client Header -->
      <div class="flex flex-col gap-2 pb-4 border-b border-[#D9E1FF]">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="text-lg font-semibold text-[#1A1A1A]">{{ getClientDisplayName() }}</div>
            <div class="text-sm text-gray-600">{{ getClientEmail() }}</div>
          </div>
          <button
            (click)="clearClientSelection()"
            class="p-1.5 rounded-lg hover:bg-[#D9E1FF] transition text-gray-600 hover:text-[#4C6FFF]"
            title="Back to agency view"
          >
            <i class="fa-solid fa-times text-sm"></i>
          </button>
        </div>
        <div class="text-xs text-gray-500 mt-1">Individual Dashboard</div>
      </div>

      <!-- Individual Dashboard Navigation -->
      <nav class="flex flex-col gap-1.5 text-sm font-medium flex-1">
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'dashboard']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-home w-5 text-center text-[#4C6FFF]"></i>
          Dashboard
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'posts']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-file-lines w-5 text-center text-[#4C6FFF]"></i>
          Posts
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'analytics']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-chart-bar w-5 text-center text-[#4C6FFF]"></i>
          Analytics
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'social-account']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-link w-5 text-center text-[#4C6FFF]"></i>
          Social Accounts
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'notifications']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-bell w-5 text-center text-[#4C6FFF]"></i>
          Notifications
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'settings']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-gear w-5 text-center text-[#4C6FFF]"></i>
          Settings
        </a>
        <a
          routerLink="/agency/billing"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center rounded-xl text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
          [class.gap-3]="!isAgencySidebarCollapsed()"
          [class.gap-0]="isAgencySidebarCollapsed()"
          [class.px-4]="!isAgencySidebarCollapsed()"
          [class.px-0]="isAgencySidebarCollapsed()"
          [class.justify-center]="isAgencySidebarCollapsed()"
          [class.justify-start]="!isAgencySidebarCollapsed()"
          [class.py-3]="!isAgencySidebarCollapsed()"
          [class.py-2.5]="isAgencySidebarCollapsed()"
        >
          <i class="fa-solid fa-credit-card w-5 text-center text-[#4C6FFF]"></i>
          Billing
        </a>
        <a
          [routerLink]="['/agency/client', selectedClient()?.id, 'profile']"
          routerLinkActive="bg-[#4C6FFF] text-white shadow-md"
          class="flex items-center gap-3 rounded-xl px-4 py-3 text-[#222222] transition hover:bg-[#BFC9FF]/50 hover:text-[#4C6FFF]"
        >
          <i class="fa-solid fa-user w-5 text-center text-[#4C6FFF]"></i>
          Profile
        </a>
      </nav>
    </aside>
  }

  <div class="flex min-h-screen flex-col">
    <header class="flex items-center justify-between gap-4 border-b border-[#D9E1FF] bg-white px-6 py-4 md:px-10 md:py-6">
      <button class="inline-flex h-11 w-11 items-center justify-center rounded-xl bg-[#F5F7FF] text-[#4C6FFF] border border-[#D9E1FF] md:hidden hover:bg-[#BFC9FF]/50 transition" (click)="toggleMenu()">
        <i class="fa-solid fa-bars text-lg"></i>
      </button>

      <div class="ml-auto text-sm font-medium text-[#222222] md:text-base">
        {{ getUserEmail() }}
      </div>
    </header>

    <main class="flex-1 px-6 py-6 md:px-10 md:py-10 bg-[#FFFFFF]">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

