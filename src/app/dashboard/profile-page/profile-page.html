<div class="min-h-screen bg-[#FFFFFF] text-[#222222] p-6">

  <!-- Client Context Banner -->
  @if (isViewingClient() && selectedClient()) {
    <div class="mb-6 rounded-xl bg-blue-50 border border-blue-200 px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-user text-blue-600"></i>
        </div>
        <div>
          <p class="text-sm font-semibold text-blue-900">Viewing Client Profile</p>
          <p class="text-xs text-blue-700">{{ selectedClient()?.name }} - {{ clientUser()?.email }}</p>
        </div>
      </div>
    </div>
  }

  <h2 class="text-2xl font-semibold mb-6 text-[#4C6FFF] flex items-center gap-2">
    <i class="fa-solid fa-user"></i> 
    @if (isViewingClient() && selectedClient()) {
      {{ selectedClient()?.name }}'s Profile
    } @else {
      Profile
    }
  </h2>

  @if (loading()) {
    <div class="flex items-center justify-center py-12">
      <div class="flex items-center gap-3 text-[#4C6FFF]">
        <i class="fa-solid fa-circle-notch animate-spin text-xl"></i>
        <span>Loading profile...</span>
      </div>
    </div>
  } @else {
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- LEFT PROFILE CARD -->
      <div class="bg-[#F5F7FF] p-6 rounded-2xl shadow-md flex flex-col items-center border border-[#D9E1FF]">

        <img [src]="getAvatarUrl()"
             [alt]="getDisplayName()"
             class="w-32 h-32 rounded-full border-4 border-[#4C6FFF] mb-4 object-cover" />

        <h3 class="text-lg font-semibold text-[#1A1A1A]">{{ getDisplayName() }}</h3>
        <p class="text-sm text-gray-600">{{ getRole() }}</p>

      </div>

      <!-- RIGHT FORM -->
      <div class="lg:col-span-2 bg-[#F5F7FF] p-6 rounded-2xl shadow-md border border-[#D9E1FF]">

        <form [formGroup]="profileForm" (ngSubmit)="onSave()" class="space-y-4">

          @if (isViewingClient()) {
            <div class="rounded-lg border border-blue-200 bg-blue-50 px-4 py-3 text-blue-700 text-sm mb-4">
              <i class="fa-solid fa-info-circle mr-2"></i>
              This is a read-only view of the client's profile. You cannot edit client information from here.
            </div>
          }

          <!-- Name -->
          <div class="relative">
            <i class="fa-solid fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
            <input
              type="text"
              formControlName="fullName"
              placeholder="Full Name"
              class="w-full bg-white border border-[#D9E1FF] rounded-lg pl-10 pr-4 py-2
                     focus:outline-none focus:ring-2 focus:ring-[#4C6FFF] text-[#222222]
                     [&.ng-invalid.ng-touched]:border-red-500"
              [readonly]="isViewingClient()"
              [class.bg-gray-50]="isViewingClient()"
              [class.cursor-not-allowed]="isViewingClient()"
            />
            @if (profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched) {
              <p class="mt-1 text-sm text-red-600">Full name is required</p>
            }
          </div>

          <!-- Email -->
          <div class="relative">
            <i class="fa-solid fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
            <input
              type="email"
              formControlName="email"
              placeholder="Email"
              class="w-full bg-white border border-[#D9E1FF] rounded-lg pl-10 pr-4 py-2
                     focus:outline-none focus:ring-2 focus:ring-[#4C6FFF] text-[#222222]
                     [&.ng-invalid.ng-touched]:border-red-500"
              [readonly]="true"
              [class.bg-gray-50]="isViewingClient()"
              [class.cursor-not-allowed]="isViewingClient()"
            />
            <p class="mt-1 text-xs text-gray-500">Email cannot be changed</p>
          </div>

          <!-- Save Button -->
          @if (!isViewingClient()) {
            <button
              type="submit"
              [disabled]="saving() || profileForm.invalid"
              class="bg-[#4C6FFF] text-white px-5 py-2 rounded-lg hover:bg-[#3A56CC]
                     transition font-medium flex items-center gap-2 shadow-sm hover:shadow-md
                     disabled:opacity-50 disabled:cursor-not-allowed"
            >
              @if (saving()) {
                <i class="fa-solid fa-circle-notch animate-spin"></i>
                <span>Saving...</span>
              } @else {
                <i class="fa-solid fa-floppy-disk"></i>
                <span>Save</span>
              }
            </button>
          }

        </form>

      </div>

    </div>
  }

</div>
