<div class="min-h-screen bg-[#FFFFFF] text-[#222222] p-6">

  <div class="mb-8">
    <h1 class="text-3xl font-bold text-[#1A1A1A] mb-2 flex items-center gap-3">
      <i class="fa-solid fa-file-alt text-[#4C6FFF]"></i> My Posts
    </h1>
    <p class="text-gray-600 text-sm">Manage and track all your social media posts</p>
  </div>

  <!-- Search + New Post -->
  <div class="flex justify-between items-center mb-6 flex-wrap gap-4">

    <div class="relative w-80">
      <i class="fa-solid fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
      <input
        type="text"
        placeholder="Search posts..."
        class="bg-[#F5F7FF] border border-[#D9E1FF] rounded-xl pl-12 pr-4 py-3 w-full
               focus:outline-none focus:ring-2 focus:ring-[#4C6FFF] text-[#222222] transition"
      />
    </div>

    <a
      routerLink="/dashboard/post-editor"
      class="bg-[#4C6FFF] text-white font-semibold px-6 py-3 rounded-xl hover:bg-[#3A56CC]
             transition-all duration-200 flex items-center gap-2 shadow-sm hover:shadow-md hover:scale-105"
    >
      <i class="fa-solid fa-plus"></i> New Post
    </a>

  </div>

  @if (isAgency()) {
    <div class="bg-[#F5F7FF] rounded-xl shadow-md p-6 border border-[#D9E1FF] mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex-1">
          <label class="block text-sm font-medium text-[#1A1A1A] mb-2 uppercase tracking-wider">
            Active Client
          </label>

          @if (loadingClients()) {
            <div class="flex items-center gap-2 text-gray-600 text-sm">
              <i class="fa-solid fa-circle-notch animate-spin text-[#4C6FFF]"></i>
              Loading clients...
            </div>
          } @else if (clients().length === 0) {
            <p class="text-gray-600 text-sm">
              No clients found. Create your first client to manage posts for your customers.
            </p>
          } @else {
            <select
              class="w-full bg-white border border-[#D9E1FF] rounded-lg px-4 py-3 text-[#222222] focus:outline-none focus:ring-2 focus:ring-[#4C6FFF]"
              [value]="selectedClientId() ?? clients()[0]?.id"
              (change)="selectClient($any($event.target).value)"
            >
              @for (client of clients(); track client.id) {
                <option [value]="client.id">{{ client.name }}</option>
              }
            </select>
          }

          @if (clientsError()) {
            <p class="mt-2 text-sm text-red-500">{{ clientsError() }}</p>
          }
        </div>

        <button type="button" (click)="addClient()"
          class="inline-flex items-center gap-2 bg-[#4C6FFF] hover:bg-[#3A56CC] text-white font-semibold px-4 py-3 rounded-lg transition">
          <i class="fa-solid fa-user-plus"></i>
          Add Client
        </button>
      </div>
    </div>
  }

  <!-- Table -->
  <ng-container *ngIf="!loading(); else loadingState">

    <div class="bg-[#F5F7FF] rounded-xl shadow-md overflow-hidden border border-[#D9E1FF]">

      <div class="overflow-x-auto">
        <table class="min-w-full">

          <!-- Header -->
          <thead class="bg-[#4C6FFF] text-white">
            <tr>
              <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2"><i class="fa-solid fa-heading"></i> Title</div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2"><i class="fa-solid fa-share-nodes"></i> Tags</div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2"><i class="fa-solid fa-circle-info"></i> Status</div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2"><i class="fa-solid fa-calendar"></i> Scheduled Date</div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2"><i class="fa-solid fa-chart-simple"></i> Engagement</div>
              </th>
            </tr>
          </thead>

          <!-- Rows -->
          <tbody class="divide-y divide-[#D9E1FF]">

            <tr
              *ngFor="let post of posts()"
              class="hover:bg-[#BFC9FF]/30 transition duration-200"
            >
              <!-- Title -->
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-semibold text-[#1A1A1A]">
                  {{ post.title || 'Untitled Post' }}
                </div>
                <div class="text-xs text-gray-600 max-w-xl truncate">
                  {{ post.content }}
                </div>
              </td>

              <!-- Platforms -->
              <td class="px-6 py-4 text-sm">
                <div class="flex gap-2 flex-wrap">
                  <span *ngFor="let platform of post.platforms"
                        class="px-2 py-1 rounded-lg bg-white border border-[#D9E1FF] text-xs text-gray-600">
                    {{ platform }}
                  </span>
                  <span *ngIf="post.platforms.length === 0"
                        class="text-xs text-gray-500">
                    No platforms
                  </span>
                </div>
              </td>

              <!-- Status -->
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="statusClass(post)">
                  {{ getStatusDisplay(post.status) }}
                </span>
              </td>

              <!-- Scheduled Date -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                {{ post.scheduledAt | date: 'mediumDate' }}
              </td>

              <!-- Engagement -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <div class="flex items-center gap-4">

                  <span>
                    <i class="fa-solid fa-eye text-[#4C6FFF]"></i>
                    {{ post.views | number }}
                  </span>

                  <span>
                    <i class="fa-solid fa-heart text-red-500"></i>
                    {{ post.reactions | number }}
                  </span>

                </div>
              </td>

            </tr>

          </tbody>

        </table>
      </div>

    </div>

  </ng-container>

  <!-- Loading State -->
  <ng-template #loadingState>
    <div class="bg-[#F5F7FF] border border-dashed border-[#D9E1FF] rounded-xl p-16 text-center">
      <i class="fa-solid fa-circle-notch animate-spin text-3xl text-[#4C6FFF] mb-3"></i>
      <p class="text-gray-600 text-sm">Loading posts...</p>
    </div>
  </ng-template>

  <!-- Error State -->
  @if (error()) {
    <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-4">
      <p class="text-red-600 text-sm">{{ error() }}</p>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && posts().length === 0) {
    <div class="bg-[#F5F7FF] border border-dashed border-[#D9E1FF] rounded-xl p-16 text-center">
      <i class="fa-solid fa-file-alt text-4xl text-gray-500 mb-4"></i>

      <p class="text-gray-700 text-lg mb-2">No posts yet</p>
      <p class="text-gray-500 text-sm mb-6">Create your first post to get started</p>

      <a
        routerLink="/dashboard/post-editor"
        class="inline-flex items-center gap-2 bg-[#4C6FFF] text-white font-semibold px-6 py-3 rounded-xl
               hover:bg-[#3A56CC] transition duration-200 shadow-md hover:shadow-lg"
      >
        <i class="fa-solid fa-plus"></i> Create Post
      </a>

    </div>
  }

</div>
